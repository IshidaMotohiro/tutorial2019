
## --------------------------------------------------------------
## MeCabãŠã‚ˆï½‚RMeCabã«ã¤ã„ã¦ã¯
browseURL("https://sites.google.com/site/rmecab/")


download.file("https://github.com/IshidaMotohiro/tutorial2019/blob/master/df.Rdata?raw=true", destfile= "df.Rdata")
df <- read.csv("df.Rdata") 

## ------------------------------------------------------------------------
head(df)


## --------------------------------------------------------------
## # ã©ã‚“ãªå˜èªãŒã‚ã‚‹ã®ã‹

df$TERM  %>%  head(20)


## ------------------------------------------------------------------------
df[df$TERM=="é–‹ç™º" , ]


## ------------------------------------------------------------------------
df[rowSums(df[, c("æ–‡æ›¸1", "æ–‡æ›¸2", "æ–‡æ›¸3")]) > 5, ]



## --------------------------------------------------------------
df$åˆè¨ˆ <- round(rowSums(df[, c("æ–‡æ›¸1", "æ–‡æ›¸2", "æ–‡æ›¸3")]), 2)ãˆ


## --------------------------------------------------------------
df %>% head()


## ------------------------------------------------------------------------
df$æ¨™æº–åŒ– <- scale(df$åˆè¨ˆ)


## --------------------------------------------------------------
df %>% head()


## tidyãªãƒ‡ãƒ¼ã‚¿å‡¦ç†
## --------------------------------------------------------------
## install.packages("tidyverse")
library(tidyverse)



## --------------------------------------------------------------
df %>% head()


## --------------------------------------------------------------
df %>% gather(key = Word,value = FREQ, æ–‡æ›¸1, æ–‡æ›¸2, æ–‡æ›¸3) 


## ------------------------------------------------------------------------
tb <- tibble(
  Name = LETTERS[1:5],
  X = 1:5, 
  Y = X^2
)


## --------------------------------------------------------------
tb


## ------------------------------------------------------------------------
temp <- tb[tb$Name=="B",]
max(temp$Y)


## ------------------------------------------------------------------------
max(tb[tb$Name=="B", ]$Y)


## ------------------------------------------------------------------------
# max(df2[df2$Name=="B",]$m)
tb %>% 
  filter(Name == "B") %>% 
  select(Y) %>% max()


## ------------------------------------------------------------------------
tb %>% 
  select(Name, Y) %>% 
  arrange(desc(Name)) %>% 
  head()


## ------------------------------------------------------------------------
tb %>% filter(Y >= 5)


## ------------------------------------------------------------------------
tb2 <- tb
tb2$Y <- scale(tb2$Y)
head(tb2)


## ------------------------------------------------------------------------
tb %>% 
  mutate(Y2 = scale(Y)) %>% 
  head()


## --------------------------------------------------------------
dat <- data.frame(Y = 1:6, X1 = c("A", "A", "B", "B", "C", "C"), X2 = 2:7, X3 = 3:8)


## ------------------------------------------------------------------------
dat


## ------------------------------------------------------------------------
dat %>% mutate_if( is.numeric, log )


## ------------------------------------------------------------------------
dat %>% summarise( X2_mean = mean(X2), 
                   X2_sd = mean(X2))


## ------------------------------------------------------------------------
dat %>% summarise_if( is.numeric, mean )


## ------------------------------------------------------------------------
dat %>% summarise_if( is.numeric, list(mean, var))


## ------------------------------------------------------------------------
dat %>% summarise_if( is.numeric,  list(~mean(.), ~sd(.)))


## --------------------------------------------------------------
text <- "
Name|Time1|Time2|Time3
A|0.1|0.18|0.11
B|0.3|0.33|0.35
C|0.2|0.22|0.26
D|0.44|0.47|0.43
E|0.51|0.56|0.55
F|0.60|0.66|0.68
G|0.77|0.78|0.72
H|0.81|0.88|0.86
"
yoko <- read_delim(file = text, delim = "|")


## ------------------------------------------------------------------------
yoko %>% head()




## --------------------------------------------------------------
yoko2 <-yoko %>% gather(
  key = time, 
  value = score, -Name)
yoko2


## --------------------------------------------------------------
df %>% head()


## ---RMeCab ã® docDF() ã®è¿”ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¸¦å‹ã«å¤‰æ›´ã™ã‚‹ ------------------
library(tidyverse)
tidy_df <- df %>% gather(key = Doc, value = FREQ,  æ–‡æ›¸1, æ–‡æ›¸2, æ–‡æ›¸3) 
tidy_tib <- as_tibble(tidy_df) # ã“ã®æ“ä½œã¯å¿…é ˆã§ã¯ãªã„

## ** tidy dataã«å¯¾ã™ã‚‹æ“ä½œ
### *** åˆ—ã‚’æŠ½å‡ºã™ã‚‹ select() ã€€ä¾‹ï¼šã€Œæ–‡æ›¸1ã€ ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿å–ã‚Šå‡ºã™æ–¹æ³•ã€‚ Doc åˆ—ãŒã€Œæ–‡æ›¸ï¼‘ã€ã§ã‚ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹
#### - tidyãªå½¢å¼ã®å ´åˆã«
tidy_tib  %>% filter( Doc == "æ–‡æ›¸1" ) 

#### - messy ãªå½¢å¼ã®å ´åˆã¯ã€Œåˆ—åã€ã¨ã—ã¦æŒ‡å®šã™ã‚‹
df %>% select( æ–‡æ›¸1 ) 


### *** åˆ—ã®æ¤œç´¢ filter() ã€€ä¾‹ï¼šå˜èªãŒã€Œç†å·¥ã€ã§ã‚ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã€ã‚ã‚‹ã„ã¯å“è©ãŒã€Œåè©ãªã„ã—å½¢å®¹è©ãªã„ã—å‹•è©ã€ã§ã‚ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹æ–¹æ³•ã€‚
#### - tidyãƒ‡ãƒ¼ã‚¿ã®å ´åˆ

tidy_tib  %>% filter( TERM  == "ç†å·¥" )
tidy_tib  %>% filter( POS1 %in% c("åè©", "å½¢å®¹è©", "å‹•è©") )

#### - messyãªå ´åˆã‚‚åŒã˜
df %>% filter( TERM == "ç†å·¥" )
df %>% filter( POS1 %in% c("åè©", "å½¢å®¹è©", "å‹•è©") )


### *** åˆ—ã®è¿½åŠ  mutate() + group_by() + summarise() ã€€ä¾‹ï¼šæ–‡æ›¸ã®é•ã„ã‚’ç„¡è¦–ã—ã¦ã€å˜èªï¼ˆTERMåˆ—ï¼‰ã§ã¾ã¨ã‚ã¦åˆè¨ˆã™ã‚‹ã€‚
#### - tidyãƒ‡ãƒ¼ã‚¿ã®å ´åˆ `tyd_tb` ã«ã¯ä¾‹ãˆã°ã€Œã€‚ã€ãŒï¼“è¡Œã‚ã‚‹ã€‚æ–‡æ›¸ãŒï¼“ç¨®é¡ã‚ã‚Šã€ãã‚Œãã‚Œã”ã¨ã«é »åº¦ãŒè¨ˆç®—ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã‚ã‚‹ã€‚ãã“ã§æ–‡æ›¸ï¼“ã¤ã‚’çµ±åˆã—ãŸé »åº¦ã‚’çŸ¥ã‚ŠãŸã„ã¨ã™ã‚‹ã€‚

tidy_tb %>% filter(TERM == "ã€‚") 
tidy_tib  %>% group_by(TERM, POS1, POS2) %>% summarize(FREQ = sum(FREQ)) 

#### - messyãªå ´åˆ  æ–°ãŸã«ã€Œåˆè¨ˆã€ã¨ã„ã†åˆ—ã‚’è¿½åŠ ã™ã‚‹ã€‚ ãŸã ã—ã€æ¨ªï¼ˆè¡Œï¼‰æ–¹å‘ã«åˆè¨ˆã‚’ã¨ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ `rowwise()` ä½µç”¨ã—å„æ–‡æ›¸ã§ã®å˜èªå‡ºç¾é »åº¦ã‚’åˆè¨ˆã™ã‚‹
df %>% rowwise() %>% mutate(åˆè¨ˆ = sum(æ–‡æ›¸1, æ–‡æ›¸2, æ–‡æ›¸3))



### ***  åˆ—ã®è¦ç´„  ä¾‹ï¼šsummarize()ã€€æ–‡æ›¸ã”ã¨ã®ç·èªæ•°ã‚’æ•°ãˆã‚‹

#### - tidyãƒ‡ãƒ¼ã‚¿ã®å ´åˆ

tidy_tib %>% group_by(Doc) %>% summarise(FREQ = sum(FREQ))

#### - messyãªå ´åˆã€€# æ•°å€¤ãŒè¨˜éŒ²ã•ã‚ŒãŸåˆ—ã‚’æŒ‡å®šã—ã¦ï¼ˆis.numericï¼‰åˆè¨ˆã‚’æ±‚ã‚ã‚‹
df %>% summarize_if(is.numeric, sum)



##é€€å±ˆãªã“ã¨ã¯Rã«ã‚„ã‚‰ã›ã‚ˆã†ï¼šè©³ç´°ã¯seiseki_Demo.Rã‚’å‚ç…§
## ------------------------------------------------------------------------
å­¦ç”Ÿç•ªå· <- stri_trans_nfkc_casefold(
 "ï¼‘ï¼ï¼‘ï¼˜ï¼ï¼•ï¼‘ï¼”ï¼•ï¼˜çŸ³ç”°åŸºåºƒ.xlsx") %>%
     str_extract(
     "\\d{8,10}\\p{Han}*.xlsx$")


## --------------------------------------------------------------
å­¦ç”Ÿç•ªå·


## ggplot2

## ------ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®æ—¥æœ¬èªè¨­å®š------------------------------------------------------------------
source("http://rmecab.jp/R/Rprofile.R")


## ---------- messyãªå½¢å¼ã‹ã‚‰tidyãªå½¢å¼ã«å¤‰æ›ãŒå¿…è¦ ----------------------------------------------------
doc <- df %>% gather(key = Doc, 
  value = FREQ, 
  æ–‡æ›¸1, æ–‡æ›¸2, æ–‡æ›¸3) 


## ------------------------------------------------------------------------
p <- doc %>% 
  ggplot(aes(POS1,
             FREQ,
             fill=Doc)) +
  geom_bar(stat = 
             "identity")


## --------------------------------------------------------------
p


## --------------------------------------------------------------
## install.packages("gapminder")
library(gapminder)


## --------------------------------------------------------------
yr <- gapminder %>%  select(-c(pop, gdpPercap)) %>% spread(key = year , value =  lifeExp)
yr



## ------------------------------------------------------------------------
gapminder <- gapminder %>%  
  filter(country %in% 
           c("Japan", "China", "Korea, Rep.")) 


## ------------------------------------------------------------------------
library(ggplot2)
p <- gapminder %>% 
  ggplot() 
# ggplot(gapminder)


## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p <- p +
  aes(x = year, 
      y = lifeExp,
      size = pop,
      col = country)


## --------------------------------------------------------------
p


## --------------------------------------------------------------
## gapminder %>%
##   ggplot(aes(x = year, y = lifeExp,
##          size = pop,col = country))


## ------------------------------------------------------------------------
p <- p + geom_point() 


## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p0 <- gapminder  %>% 
  ggplot(aes(
   x = year, 
   y = lifeExp, 
   size = pop))  +
  geom_point(
    show.legend = 
    FALSE,
    col = "red") #ğŸ‘ˆ


## --------------------------------------------------------------
p0


## ------------------------------------------------------------------------
gapminder %>% 
  group_by(year) %>% 
  summarise(AVG = mean(gdpPercap)) 


## ------------------------------------------------------------------------
p <- gapminder %>% 
  ggplot(aes(year, 
    gdpPercap)) +
  geom_bar(stat = 
    "summary",
    fun.y = "mean")


## --------------------------------------------------------------
p


## --------------------------------------------------------------
gap_avg <- gapminder %>% 
  group_by(year) %>% 
  summarise(AVG = mean(gdpPercap)) 


## ------------------------------------------------------------------------
gap_avg


## ------------------------------------------------------------------------
p <- gap_avg %>% 
  ggplot(
   aes(year, AVG)) +
  geom_bar(
  stat ="identity")


## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p <- gapminder %>% 
  ggplot(aes(year, 
    gdpPercap)) +
  stat_summary(
    geom = "bar",
    fun.y = "mean") +
  stat_summary(
    geom = "errorbar",
    fun.data = "mean_se")



## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p <- doc %>% 
  ggplot(aes(POS1,
             FREQ,
        fill = Doc)) +
  geom_bar(stat =
      "identity")


## ------------------------------------------------------------------------
p


## ------------------------------------------------------------------------
p <- gapminder %>% 
  filter(country == "China") %>% 
  ggplot(aes(lifeExp)) +
  geom_histogram()


## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p <- gapminder %>% 
  filter(country == "China") %>% 
  ggplot(aes(lifeExp)) +
  geom_histogram(bins = 6)


## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p <- gapminder %>% 
  filter(country == "China") %>% 
  ggplot(aes(lifeExp,
    y = ..density.. )) +
  geom_histogram(bins = 6)


## ------------------------------------------------------------------------
p + geom_density()


## ------------------------------------------------------------------------
p <- gapminder %>% 
  ggplot(aes(year, 
    lifeExp,
    group=country)) +
  geom_line()


## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p <- gapminder %>% 
  ggplot(
   aes(x=country, 
       y=gdpPercap)) +
  geom_boxplot()



## --------------------------------------------------------------
p


## ------------------------------------------------------------------------
p_f <- p + 
  facet_grid(. 
    ~ country)


## ------------------------------------------------------------------------
p_f


## ------------------------------------------------------------------------
p_f <- p + 
  facet_grid(. 
    ~ country,
    scales = "free")


## ------------------------------------------------------------------------
p_f


## ------------------------------------------------------------------------
p <- p +
  theme_classic()


## --------------------------------------------------------------
p 

